(()=>{"use strict";var e,t={589:(e,t,i)=>{var s=i(260),r=i.n(s);class h extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.atlas("confetti","assets\\particles\\cofetti.png","assets\\particles\\cofetti.json"),this.load.atlas("flares","assets/particles/flares.png","assets/particles/flares.json"),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const a={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:80,tileHeight:90,candyTypes:["cookie1","croissant","donut","macaroon","starcookie1"]};class o extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e),this.angleRotationRate=Phaser.Math.Between(-180,180)}update(e,t,i){return super.update(e,t,i),this.alpha-=.025*t,this.alpha<0&&this.destroy(),this.angle-=this.angleRotationRate*t,this.y-=400*t,super.update(e,t,i)}}class l extends Phaser.GameObjects.Container{constructor(e,t,i){super(e,t,i),this.score=0,this.phaseScore=500,this.newPhase=!1,this.scoreText=this.scene.add.text(this.scene.cameras.main.width/2-t,this.scene.cameras.main.height/2-i/1.75,"SCORE: 0",{fontSize:32}).setOrigin(.5),this.background=this.scene.add.graphics(),this.background.lineStyle(3,16753920,1),this.background.fillStyle(0,.8).setAlpha(.75),this.background.fillRoundedRect(0,0,500,150,10),this.background.strokeRoundedRect(0,0,500,150,10),this.createLoadingBar(),this.add(this.background),this.add(this.scoreText),this.add(this.loadingBar),this.add(this.progressBar),this.scene.add.existing(this)}createLoadingBar(){this.loadingBar=this.scene.add.graphics(),this.loadingBar.fillStyle(7908062,1),this.loadingBar.fillRect(0,this.scene.cameras.main.height/2-this.y/2,500,20),this.progressBar=this.scene.add.graphics()}addScore(e){this.score+=e,this.scoreText.setText("SCORE: "+this.score.toString()),this.progressBar.clear(),this.progressBar.fillStyle(16753920,1),this.progressBar.fillRect(0,this.scene.cameras.main.height/2-this.y/2,500*(this.score/this.phaseScore>=1?1:this.score/this.phaseScore),20),this.phaseScore<=this.score&&(this.newPhase=!0,this.phaseScore=1.5*this.score,this.scene.add.particles(this.scene.cameras.main.width/2,this.scene.cameras.main.height,"confetti",{lifespan:15e3,frame:["red.png","yellow.png","green.png","orange.png","blue.png","pink.png"],angle:{min:180,max:360},speedX:{min:-75,max:75},speedY:{min:-125,max:-175},gravityY:60,scale:{min:.1,max:1.5},emitting:!0,particleClass:o}).explode(150))}}class n extends Phaser.GameObjects.Image{constructor(e,t,i){super(e.scene,e.x,e.y,e.texture,e.frame),this.isBurst=!1,this.setOrigin(.5).setInteractive(),this.setupEffect(),this.scene.add.existing(this),this.setupParticles(),this.tileGraphics=this.scene.add.graphics(),this.gridX=t,this.gridY=i}setupEffect(){this.selectEffect=this.scene.tweens.add({targets:this,scaleX:1.1,scaleY:.9,repeat:-1,yoyo:!0,duration:200,ease:"Linear"}).pause()}setupParticles(){this.particleEmitter=this.scene.add.particles(this.x-a.tileWidth/2,this.y-a.tileHeight/2,"flares",{frame:["red","yellow","green","white","blue"],lifespan:1250,speed:{min:150,max:200},scale:{start:.25,end:0},gravityY:120,blendMode:"ADD",emitting:!1}),this.burstParticleEmitterSmall=this.scene.add.particles(this.x,this.y,"flares",{frame:"white",color:[9887962,9666291],colorEase:"quart.out",lifespan:500,speed:100,quantity:10,blendMode:"ADD",scale:{start:.25,end:0},alpha:{start:1,end:0},gravityY:0,accelerationY:-20,rotate:{start:0,end:360}}).setDepth(-1).setVisible(!1).setActive(!1),this.burstParticleEmitterBig=this.scene.add.particles(this.x,this.y,"flares",{frame:"white",color:[16436258,16291840,16266752,10421252],colorEase:"quad.out",lifespan:500,speed:100,quantity:20,blendMode:"ADD",scale:{start:.25,end:0},alpha:{start:1,end:0},gravityY:0,accelerationY:-20,rotate:{start:0,end:360}}).setDepth(-1).setVisible(!1).setActive(!1),this.burstParticleEmitterBig.pause(),this.burstParticleEmitterSmall.pause()}backToPosition(){const e=this.gridX*a.tileWidth+a.tileWidth/2,t=this.gridY*a.tileHeight+a.tileHeight/2;this.scene.add.tween({targets:this,x:e,y:t,rotation:0,ease:"cubic.inout",repeat:0,duration:750,onCompleteScope:this})}setRandomTextures(){const e=a.candyTypes[Phaser.Math.RND.between(0,a.candyTypes.length-1)];this.texture.key=e}showSelectEffect(){this.selectEffect.resume(),this.tileGraphics.lineStyle(2,16766336,1),this.tileGraphics.strokeRoundedRect(this.x-a.tileWidth/2,this.y-a.tileHeight/2,a.tileWidth,a.tileHeight,10)}deselect(){this.selectEffect.pause(),this.setScale(1),this.tileGraphics.clear()}explode(){this.particleEmitter.setX(this.x),this.particleEmitter.setY(this.y),this.particleEmitter.explode(9)}burst(e){e?(this.burstParticleEmitterBig.setActive(!0).setVisible(!0),this.burstParticleEmitterBig.resume()):(this.burstParticleEmitterSmall.setActive(!0).setVisible(!0),this.burstParticleEmitterSmall.resume())}stopBurst(){this.burstParticleEmitterSmall&&(this.burstParticleEmitterSmall.setActive(!1).setVisible(!1),this.burstParticleEmitterSmall.stop()),this.burstParticleEmitterBig&&(this.burstParticleEmitterBig.setActive(!1).setVisible(!1),this.burstParticleEmitterBig.stop())}showIdleEffect(){this.idleEffect=this.scene.tweens.add({targets:this,rotation:Phaser.Math.PI2,repeat:0,duration:500,ease:"sine.out",onComplete:()=>{this.idleEffect.destroy()},onCompleteScope:this})}showHintEffect(){this.hintEffect=this.scene.tweens.add({targets:this,scaleX:.9,scaleY:1.1,y:"-=15",ease:"Power2",startDelay:1e3,yoyo:!0,repeat:1,duration:300,onComplete:()=>{this.hintEffect.destroy()},onCompleteScope:this})}getKey(){return this.texture.key}update(){this.isBurst&&(this.burstParticleEmitterSmall.x=this.x,this.burstParticleEmitterSmall.y=this.y,this.burstParticleEmitterBig.x=this.x,this.burstParticleEmitterBig.y=this.y)}}var d;!function(e){e[e.IDLE=0]="IDLE",e[e.ACTIVE=1]="ACTIVE"}(d||(d={}));class c extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.grid=new Map,this.idleTime=0,this.IDLE_TIME=5e3}create(){this.cameras.main.setBackgroundColor(7908062),this.scoreBoard=new l(this,this.cameras.main.width/2-250,this.cameras.main.height/1.25).setDepth(10),this.shuffle(),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.boardState=d.ACTIVE,this.input.on("gameobjectdown",this.tileDown,this)}update(e,t){if(this.idleTime+=t,this.IDLE_TIME<=this.idleTime&&this.boardState==d.IDLE){this.grid.forEach((e=>{null==e||e.showIdleEffect()}));const e=this.hintTiles();this.checkTweensComplete().then((()=>{var t;const i=Phaser.Math.RND.between(0,e.length-1);for(const s of e[i])null===(t=this.grid.get(s))||void 0===t||t.showHintEffect()})),this.idleTime=0}this.grid.forEach((e=>{null==e||e.update()})),this.scoreBoard.newPhase&&(this.checkTweensComplete().then((()=>{this.grid.forEach((e=>{null==e||e.stopBurst(),null==e||e.destroy()})),this.grid.clear(),this.checkTweensComplete().then((()=>{this.shuffle()}))})),this.scoreBoard.newPhase=!1,this.scoreBoard.addScore(0))}addTile(e,t){const i=a.candyTypes[Phaser.Math.RND.between(0,a.candyTypes.length-1)];return new n({scene:this,x:this.cameras.main.width/2,y:this.cameras.main.height/2,texture:i},e,t)}shuffle(){var e,t;this.boardState=d.ACTIVE;for(let i=0;i<a.gridHeight;i++)for(let s=0;s<a.gridWidth;s++)null===(e=this.grid.get(this.indexToKey(i,s)))||void 0===e||e.stopBurst(),null===(t=this.grid.get(this.indexToKey(i,s)))||void 0===t||t.destroy(),this.grid.set(this.indexToKey(i,s),void 0);const i=this.getShuffleShape();for(let e=0;e<a.gridHeight;e++)for(let t=0;t<a.gridWidth;t++){const s=this.addTile(e,t);this.grid.set(this.indexToKey(e,t),s);const r={value:(e*a.gridHeight+t)/(a.gridHeight*a.gridWidth)},h=this.getPointFromShape(i,r.value);void 0!==s&&(s.x=h.x,s.y=h.y),this.tweens.add({targets:r,value:r.value+1,duration:1e3,repeat:0,ease:"sine.out",onComplete:()=>{null==s||s.backToPosition()},onCompleteScope:this,onUpdate:()=>{r.value>1&&(r.value-=1);const e=this.getPointFromShape(i,r.value);void 0!==s&&(s.x=e.x,s.y=e.y)},onUpdateScope:this})}this.checkTweensComplete().then((()=>{this.checkMatches()})),this.idleTime=0}getPointFromShape(e,t){return e instanceof Phaser.Geom.Rectangle?Phaser.Geom.Rectangle.GetPoint(e,t):Phaser.Geom.Circle.GetPoint(e,t)}getShuffleShape(){const e=Phaser.Math.RND.between(0,1),t=this.cameras.main.width/2,i=this.cameras.main.width/2;return 0==e?new Phaser.Geom.Rectangle(t-200,i-200,400,400):new Phaser.Geom.Circle(t,i,225)}getTileKey(e,t){return((e-a.tileWidth/2)/a.tileWidth).toString()+((t-a.tileHeight/2)/a.tileHeight).toString()}tileDown(e,t){this.idleTime=0,this.boardState=d.ACTIVE,void 0===this.firstSelectedTile?(this.firstSelectedTile=t,this.firstSelectedTile.showSelectEffect()):this.isAdjacentTile(this.firstSelectedTile,t)?(this.firstSelectedTile.deselect(),this.firstSelectedTile===t?this.firstSelectedTile=void 0:(this.secondSelectedTile=t,this.swapTiles())):(this.firstSelectedTile.deselect(),this.firstSelectedTile=t,this.firstSelectedTile.showSelectEffect())}isAdjacentTile(e,t){const i=Math.abs(e.x-t.x)/a.tileWidth,s=Math.abs(e.y-t.y)/a.tileHeight;return 1===i&&0===s||0===i&&1===s||0===i&&0===s}resetTiles(){this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.boardState=d.IDLE}swapTiles(){var e,t,i,s,r,h,a,o;if(void 0!==this.firstSelectedTile&&void 0!==this.secondSelectedTile){this.idleTime=0,this.grid.set(this.getTileKey(null===(e=this.firstSelectedTile)||void 0===e?void 0:e.x,null===(t=this.firstSelectedTile)||void 0===t?void 0:t.y),this.secondSelectedTile),this.grid.set(this.getTileKey(null===(i=this.secondSelectedTile)||void 0===i?void 0:i.x,null===(s=this.secondSelectedTile)||void 0===s?void 0:s.y),this.firstSelectedTile);const l=this.add.tween({targets:this.firstSelectedTile,x:this.secondSelectedTile.x,y:this.secondSelectedTile.y,rotation:Phaser.Math.PI2,ease:"sine.inout",duration:500,repeat:0,yoyo:!1}),n=this.add.tween({targets:this.secondSelectedTile,x:this.firstSelectedTile.x,y:this.firstSelectedTile.y,rotation:Phaser.Math.PI2,ease:"sine.inout",duration:500,repeat:0,yoyo:!1,onComplete:()=>{l.destroy(),n.destroy(),this.checkMatches()}});this.firstSelectedTile=this.grid.get(this.getTileKey(null===(r=this.firstSelectedTile)||void 0===r?void 0:r.x,null===(h=this.firstSelectedTile)||void 0===h?void 0:h.y)),this.secondSelectedTile=this.grid.get(this.getTileKey(null===(a=this.secondSelectedTile)||void 0===a?void 0:a.x,null===(o=this.secondSelectedTile)||void 0===o?void 0:o.y))}}checkMatches(){const e=this.getMatches();if(e.length>0){for(const t of e)3==t.length?this.handle3Mathces(t):this.handleGreaterThan3Mathces(t);this.checkTweensComplete().then((()=>{this.updateGrid(),this.fillTiles(),this.checkTweensComplete().then((()=>{this.checkMatches(),this.idleTime=0}))})),this.boardState=d.ACTIVE}else this.swapTiles();this.resetTiles()}getAdjacentBurstTiles(e){const t={0:{x:-1,y:-1},1:{x:-1,y:0},2:{x:-1,y:1},3:{x:0,y:-1},4:{x:0,y:1},5:{x:1,y:-1},6:{x:1,y:0},7:{x:1,y:1}},i=parseInt(e[0]),s=parseInt(e[1]),r=[];for(let e=0;e<8;e++){const h=this.indexToKey(i+t[e].x,s+t[e].y);void 0!==this.grid.get(h)&&r.push(h)}return r}handle3Mathces(e){let t=0;for(const t of e){const i=this.grid.get(t);i&&i.isBurst&&(e=e.concat(this.getAdjacentBurstTiles(t)),i.isBurst=!1)}for(const i of e){const e=this.grid.get(i);null==e||e.stopBurst(),null==e||e.explode(),null==e||e.destroy(),this.grid.set(i,void 0),t+=10}this.scoreBoard.addScore(t)}handleGreaterThan3Mathces(e){var t,i;let s=0;for(let r=0;r<e.length;r++)if(r!==e.length-1){const h=this.grid.get(e[r]);void 0!==h&&(h.explode(),this.tweens.add({targets:h,x:null===(t=this.grid.get(e[e.length-1]))||void 0===t?void 0:t.x,y:null===(i=this.grid.get(e[e.length-1]))||void 0===i?void 0:i.y,duration:250,ease:"sine.in",repeat:0,yoyo:!1,onComplete:()=>{s+=10,null==h||h.stopBurst(),null==h||h.destroy(),this.grid.set(e[r],void 0),this.cameras.main.shake(150,.0075)},onCompleteScope:this}))}this.scoreBoard.addScore(s+10),this.checkTweensComplete().then((()=>{const t=this.grid.get(e[e.length-1]);void 0!==t&&(t.isBurst=!0,4==e.length?t.burst(!1):t.burst(!0))}))}checkTweensComplete(){return new Promise((e=>{const t=()=>{0===this.tweens.getTweens().filter((e=>e.isPlaying())).length?e():setTimeout(t,100)};t()}))}indexToKey(e,t){return e.toString()+t.toString()}getMatches(){const e=[];let t=[];for(let i=0;i<a.gridWidth;i++){let s=1;for(let r=0;r<a.gridHeight-1;r++){const h=this.grid.get(this.indexToKey(i,r)),o=this.grid.get(this.indexToKey(i,r+1));if(h&&o)if(h.getKey()===o.getKey()){if(s+=1,r==a.gridHeight-2&&s>=3){for(let e=r-s+2;e<=r+1;e++)t.push(this.indexToKey(i,e));e.push(t),t=[]}}else{if(s>=3){for(let e=r-s+1;e<r+1;e++)t.push(this.indexToKey(i,e));e.push(t),t=[]}s=1}}}for(let i=0;i<a.gridWidth;i++){let s=1;for(let r=0;r<a.gridHeight-1;r++){const h=this.grid.get(this.indexToKey(r,i)),o=this.grid.get(this.indexToKey(r+1,i));if(h&&o)if(h.getKey()===o.getKey()){if(s+=1,r==a.gridHeight-2&&s>=3){for(let e=r-s+2;e<=r+1;e++)t.push(this.indexToKey(e,i));e.push(t),t=[]}}else{if(s>=3){for(let e=r-s+1;e<r+1;e++)t.push(this.indexToKey(e,i));e.push(t),t=[]}s=1}}}return e}updateGrid(){for(let e=a.gridWidth-1;e>=0;e--)for(let t=a.gridHeight-1;t>0;t--){const i=this.grid.get(this.indexToKey(e,t)),s=this.grid.get(this.indexToKey(e,t-1));void 0===i&&void 0!==s&&(this.grid.set(this.indexToKey(e,t),s),this.grid.set(this.indexToKey(e,t-1),void 0),this.add.tween({targets:s,y:a.tileHeight*t+a.tileHeight/2,ease:"sine.inout",duration:400,repeat:0,yoyo:!1,onComplete:()=>{},onCompleteScope:this}),t=a.gridHeight)}}fillTiles(){for(let e=a.gridWidth-1;e>=0;e--)for(let t=a.gridHeight-1;t>=0;t--)if(void 0===this.grid.get(this.indexToKey(e,t))){const i=e*a.tileWidth+a.tileWidth/2,s=-1*a.tileHeight+a.tileHeight/2,r=this.addTile(e,t);r.setX(i),r.setY(s),this.grid.set(this.indexToKey(e,t),r),this.add.tween({targets:r,y:a.tileHeight*t+a.tileHeight/2,ease:"sine.inout",duration:300,repeat:0,yoyo:!1,onComplete:()=>{},onCompleteScope:this})}}hintTiles(){let e=[];for(let t=0;t<a.gridHeight;t++)for(let i=0;i<a.gridWidth-1;i++){const s=this.indexToKey(t,i),r=this.indexToKey(t,i+1),h=this.grid.get(s),a=this.grid.get(r);if(this.grid.set(this.indexToKey(t,i),a),this.grid.set(this.indexToKey(t,i+1),h),this.getMatches().length>0){const t=this.getMatches();for(const e of t){const t=e.indexOf(s);if(-1==t){const t=e.indexOf(r);e.splice(t,1,s)}else e.splice(t,1,r)}e=e.concat(t)}this.grid.set(this.indexToKey(t,i),h),this.grid.set(this.indexToKey(t,i+1),a)}for(let t=0;t<a.gridHeight-1;t++)for(let i=0;i<a.gridWidth;i++){const s=this.indexToKey(t,i),r=this.indexToKey(t+1,i),h=this.grid.get(s),a=this.grid.get(r);if(this.grid.set(this.indexToKey(t,i),a),this.grid.set(this.indexToKey(t+1,i),h),this.getMatches().length>0){const t=this.getMatches();for(const e of t){const t=e.indexOf(s);if(-1==t){const t=e.indexOf(r);e.splice(t,1,s)}else e.splice(t,1,r)}e=e.concat(t)}this.grid.set(this.indexToKey(t,i),h),this.grid.set(this.indexToKey(t+1,i),a)}return console.log(e),e}}const g={title:"Candy crush",version:"2.0",width:640,height:window.innerHeight,type:Phaser.AUTO,parent:"game",scene:[h,c],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class p extends r().Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new p(g)}))}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var h=i[e]={exports:{}};return t[e].call(h.exports,h,h.exports,s),h.exports}s.m=t,e=[],s.O=(t,i,r,h)=>{if(!i){var a=1/0;for(d=0;d<e.length;d++){for(var[i,r,h]=e[d],o=!0,l=0;l<i.length;l++)(!1&h||a>=h)&&Object.keys(s.O).every((e=>s.O[e](i[l])))?i.splice(l--,1):(o=!1,h<a&&(a=h));if(o){e.splice(d--,1);var n=r();void 0!==n&&(t=n)}}return t}h=h||0;for(var d=e.length;d>0&&e[d-1][2]>h;d--)e[d]=e[d-1];e[d]=[i,r,h]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var r,h,[a,o,l]=i,n=0;if(a.some((t=>0!==e[t]))){for(r in o)s.o(o,r)&&(s.m[r]=o[r]);if(l)var d=l(s)}for(t&&t(i);n<a.length;n++)h=a[n],s.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var r=s.O(void 0,[216],(()=>s(589)));r=s.O(r)})();