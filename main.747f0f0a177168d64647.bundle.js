(()=>{"use strict";var e,t={348:(e,t,i)=>{var s=i(260),h=i.n(s);class r extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.atlas("flares","assets/particles/flares.png","assets/particles/flares.json"),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const o={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,candyTypes:["cookie1","croissant","cupcake","donut","macaroon","poptart1","starcookie1"]};class l extends Phaser.GameObjects.Image{constructor(e,t,i){super(e.scene,e.x,e.y,e.texture,e.frame),this.setOrigin(.5).setInteractive(),this.setupEffect(),this.scene.add.existing(this),this.gridX=t,this.gridY=i}setupEffect(){this.selectEffect=this.scene.tweens.add({targets:this,scaleX:1.1,scaleY:.9,repeat:-1,yoyo:!0,duration:200,ease:"Linear"}).pause(),this.idleEffect=this.scene.tweens.add({targets:this,rotation:Phaser.Math.PI2,repeat:0,yoyo:!0,duration:300,ease:"sine.out"}).pause()}setupParticles(){const e=new Phaser.Geom.Rectangle(0,0,this.width,this.height);this.particleEmitter=this.scene.add.particles(this.x-o.tileWidth/2,this.y-o.tileHeight/2,"flares",{frame:{frames:["white"],cycle:!1},blendMode:"ADD",lifespan:250,quantity:1,scale:{start:.1,end:.01}}),this.particleEmitter.addEmitZone({type:"edge",source:e,quantity:64,total:1})}setupSwapEffect(e,t,i){this.swapEffect=this.scene.tweens.add({targets:this,x:e,y:t,repeat:0,duration:400,ease:"sine.inout",onComplete:i,onCompleteScope:this})}backToPosition(){const e=this.gridX*o.tileWidth+o.tileWidth/2,t=this.gridY*o.tileHeight+o.tileHeight/2;this.scene.add.tween({targets:this,x:e,y:t,rotation:0,ease:"cubic.inout",repeat:0,duration:750,onCompleteScope:this})}setRandomTextures(){const e=o.candyTypes[Phaser.Math.RND.between(0,o.candyTypes.length-1)];this.texture.key=e}showSelectEffect(){this.selectEffect.resume(),this.setupParticles()}deselect(){this.selectEffect.pause(),this.setScale(1),this.particleEmitter.pause(),this.particleEmitter.setVisible(!1)}showIdleEffect(){this.selectEffect.resume()}showMatchEffect(){}getKey(){return this.texture.key}}class a extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.grid=new Map,this.init=!1}create(){this.canMove=!0,this.cameras.main.setBackgroundColor(7908062);for(let e=0;e<o.gridHeight;e++)for(let t=0;t<o.gridWidth;t++){const i=this.addTile(e,t);this.grid.set(this.createKey(e,t),i)}this.shuffle(),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.input.on("gameobjectdown",this.tileDown,this)}createKey(e,t){return e.toString()+t.toString()}addTile(e,t){const i=o.candyTypes[Phaser.Math.RND.between(0,o.candyTypes.length-1)];return new l({scene:this,x:this.cameras.main.width/2,y:this.cameras.main.height/2,texture:i},e,t)}shuffle(){const e=this.getShuffleShape();for(let t=0;t<o.gridHeight;t++)for(let i=0;i<o.gridWidth;i++){const s=this.grid.get(this.createKey(t,i)),h={value:(t*o.gridHeight+i)/(o.gridHeight*o.gridWidth)},r=this.getPointFromShape(e,h.value);void 0!==s&&(s.x=r.x,s.y=r.y),this.tweens.add({targets:h,value:h.value+1,duration:1e3,repeat:0,ease:"sine.out",onComplete:()=>{null==s||s.backToPosition()},onCompleteScope:this,onUpdate:()=>{h.value>1&&(h.value-=1);const t=this.getPointFromShape(e,h.value);void 0!==s&&(s.x=t.x,s.y=t.y)},onUpdateScope:this})}setTimeout((()=>{this.checkMatches()}),2e3)}getPointFromShape(e,t){return e instanceof Phaser.Geom.Rectangle?Phaser.Geom.Rectangle.GetPoint(e,t):Phaser.Geom.Circle.GetPoint(e,t)}getShuffleShape(){const e=Phaser.Math.RND.between(0,1),t=this.cameras.main.width/2,i=this.cameras.main.width/2;return 0==e?new Phaser.Geom.Rectangle(t-200,i-200,400,400):new Phaser.Geom.Circle(t,i,225)}getTileKey(e,t){return((e-o.tileWidth/2)/o.tileWidth).toString()+((t-o.tileHeight/2)/o.tileHeight).toString()}tileDown(e,t){this.canMove&&(void 0===this.firstSelectedTile?(this.firstSelectedTile=t,this.firstSelectedTile.showSelectEffect()):this.isAdjacentTile(this.firstSelectedTile,t)?(this.canMove=!1,this.firstSelectedTile.deselect(),this.firstSelectedTile===t?(this.firstSelectedTile=void 0,this.canMove=!0):(this.secondSelectedTile=t,this.swapTiles())):(this.firstSelectedTile.deselect(),this.firstSelectedTile=t,this.firstSelectedTile.showSelectEffect()))}isAdjacentTile(e,t){const i=Math.abs(e.x-t.x)/o.tileWidth,s=Math.abs(e.y-t.y)/o.tileHeight;return 1===i&&0===s||0===i&&1===s||0===i&&0===s}resetTiles(){this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.canMove=!0}swapTiles(){var e,t,i,s,h,r,o,l;if(void 0!==this.firstSelectedTile&&void 0!==this.secondSelectedTile){this.grid.set(this.getTileKey(null===(e=this.firstSelectedTile)||void 0===e?void 0:e.x,null===(t=this.firstSelectedTile)||void 0===t?void 0:t.y),this.secondSelectedTile),this.grid.set(this.getTileKey(null===(i=this.secondSelectedTile)||void 0===i?void 0:i.x,null===(s=this.secondSelectedTile)||void 0===s?void 0:s.y),this.firstSelectedTile);const a=this.add.tween({targets:this.firstSelectedTile,x:this.secondSelectedTile.x,y:this.secondSelectedTile.y,ease:"sine.inout",duration:500,repeat:0,yoyo:!1}),n=this.add.tween({targets:this.secondSelectedTile,x:this.firstSelectedTile.x,y:this.firstSelectedTile.y,ease:"sine.inout",duration:500,repeat:0,yoyo:!1,onComplete:()=>{a.destroy(),n.destroy(),this.checkMatches()}});this.firstSelectedTile=this.grid.get(this.getTileKey(null===(h=this.firstSelectedTile)||void 0===h?void 0:h.x,null===(r=this.firstSelectedTile)||void 0===r?void 0:r.y)),this.secondSelectedTile=this.grid.get(this.getTileKey(null===(o=this.secondSelectedTile)||void 0===o?void 0:o.x,null===(l=this.secondSelectedTile)||void 0===l?void 0:l.y))}}checkMatches(){const e=this.getMatches();for(const t of e)console.log(t);if(e.length>0){for(const t of e)3==t.length?this.handle3Mathces(t):this.handleGreaterThan3Mathces(t);this.checkTweensComplete().then((()=>{this.updateGrid()})),this.checkTweensComplete().then((()=>{this.fillTiles(),this.checkTweensComplete().then((()=>{this.checkMatches()}))}))}else this.swapTiles();this.resetTiles()}handle3Mathces(e){var t;for(const i of e)null===(t=this.grid.get(i))||void 0===t||t.setActive(!1).setVisible(!1),this.grid.set(i,void 0)}handleGreaterThan3Mathces(e){var t,i;for(let s=0;s<e.length;s++)if(s!==e.length-1){const h=this.grid.get(e[s]);this.tweens.add({targets:h,x:null===(t=this.grid.get(e[e.length-1]))||void 0===t?void 0:t.x,y:null===(i=this.grid.get(e[e.length-1]))||void 0===i?void 0:i.y,duration:300,ease:"sine.in",repeat:0,yoyo:!1,onComplete:()=>{null==h||h.setActive(!1).setVisible(!1),this.grid.set(e[s],void 0)},onCompleteScope:this})}}checkTweensComplete(){return new Promise((e=>{const t=()=>{0===this.tweens.getTweens().filter((e=>e.isPlaying())).length?e():setTimeout(t,100)};t()}))}indexToKey(e,t){return e.toString()+t.toString()}getMatches(){const e=[];let t=[];for(let i=0;i<o.gridWidth;i++){let s=1;for(let h=0;h<o.gridHeight-1;h++){const r=this.grid.get(this.indexToKey(i,h)),l=this.grid.get(this.indexToKey(i,h+1));if(r&&l)if(r.getKey()===l.getKey()){if(s+=1,h==o.gridHeight-2&&s>=3){for(let e=h-s+2;e<=h+1;e++)t.push(this.indexToKey(i,e));e.push(t),t=[]}}else{if(s>=3){for(let e=h-s+1;e<h+1;e++)t.push(this.indexToKey(i,e));e.push(t),t=[]}s=1}}}for(let i=0;i<o.gridWidth;i++){let s=1;for(let h=0;h<o.gridHeight-1;h++){const r=this.grid.get(this.indexToKey(h,i)),l=this.grid.get(this.indexToKey(h+1,i));if(r&&l)if(r.getKey()===l.getKey()){if(s+=1,h==o.gridHeight-2&&s>=3){for(let e=h-s+2;e<=h+1;e++)t.push(this.indexToKey(e,i));e.push(t),t=[]}}else{if(s>=3){for(let e=h-s+1;e<h+1;e++)t.push(this.indexToKey(e,i));e.push(t),t=[]}s=1}}}return e}updateGrid(){for(let e=o.gridWidth-1;e>=0;e--)for(let t=o.gridHeight-1;t>0;t--){const i=this.grid.get(this.indexToKey(e,t)),s=this.grid.get(this.indexToKey(e,t-1));void 0===i&&void 0!==s&&(this.grid.set(this.indexToKey(e,t),s),this.grid.set(this.indexToKey(e,t-1),void 0),this.add.tween({targets:s,y:o.tileHeight*t+o.tileHeight/2,ease:"sine.inout",duration:400,repeat:0,yoyo:!1,onComplete:()=>{console.log("Finish Update")},onCompleteScope:this}),t=o.gridHeight)}}fillTiles(){for(let e=o.gridWidth-1;e>=0;e--)for(let t=o.gridHeight-1;t>=0;t--)if(void 0===this.grid.get(this.indexToKey(e,t))){const i=e*o.tileWidth+o.tileWidth/2,s=-1*o.tileHeight+o.tileHeight/2,h=this.addTile(e,t);h.setX(i),h.setY(s),this.grid.set(this.indexToKey(e,t),h),this.add.tween({targets:h,y:o.tileHeight*t+o.tileHeight/2,ease:"sine.inout",duration:300,repeat:0,yoyo:!1,onComplete:()=>{console.log("Add New Tiles")},onCompleteScope:this})}}}const n={title:"Candy crush",version:"2.0",width:520,height:window.innerHeight,type:Phaser.AUTO,parent:"game",scene:[r,a],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class d extends h().Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new d(n)}))}},i={};function s(e){var h=i[e];if(void 0!==h)return h.exports;var r=i[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,i,h,r)=>{if(!i){var o=1/0;for(d=0;d<e.length;d++){for(var[i,h,r]=e[d],l=!0,a=0;a<i.length;a++)(!1&r||o>=r)&&Object.keys(s.O).every((e=>s.O[e](i[a])))?i.splice(a--,1):(l=!1,r<o&&(o=r));if(l){e.splice(d--,1);var n=h();void 0!==n&&(t=n)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[i,h,r]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var h,r,[o,l,a]=i,n=0;if(o.some((t=>0!==e[t]))){for(h in l)s.o(l,h)&&(s.m[h]=l[h]);if(a)var d=a(s)}for(t&&t(i);n<o.length;n++)r=o[n],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var h=s.O(void 0,[216],(()=>s(348)));h=s.O(h)})();